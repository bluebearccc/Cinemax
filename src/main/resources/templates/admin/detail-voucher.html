<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Voucher Details</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-gradient-hover: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            --primary-color: #667eea;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --border-color: #dee2e6;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: var(--primary-gradient) !important;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            color: white !important;
            font-weight: bold;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.8) !important;
            transition: color 0.2s ease;
        }

        .nav-link:hover {
            color: white !important;
        }

        .nav-link.active {
            color: white !important;
            font-weight: 600;
        }

        .card {
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border: none;
            border-radius: 15px;
        }

        .card-header {
            background: var(--primary-gradient);
            color: white;
            font-weight: bold;
            border-radius: 15px 15px 0 0 !important;
        }

        .voucher-code {
            background-color: #e9ecef;
            border: 2px dashed var(--primary-color);
            padding: 15px;
            text-align: center;
            font-family: monospace;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            letter-spacing: 2px;
            border-radius: 10px;
        }

        .discount-badge {
            background: var(--primary-gradient);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .status-active {
            background-color: var(--success-color);
            color: white;
        }

        .status-expired {
            background-color: var(--danger-color);
            color: white;
        }

        .status-pending {
            background-color: var(--warning-color);
            color: #212529;
        }

        .info-row {
            border-bottom: 1px solid #eee;
            padding: 12px 0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #666;
        }

        .info-value {
            color: #333;
        }

        .btn-group-custom {
            gap: 10px;
        }

        .btn-secondary {
            border-radius: 8px;
        }

        .btn-warning {
            background: var(--primary-gradient);
            border: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            color: white;
        }

        .btn-warning:hover {
            background: var(--primary-gradient-hover);
            transform: translateY(-1px);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            border: none;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .breadcrumb-item a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .breadcrumb-item a:hover {
            color: var(--primary-gradient-hover);
        }

        .quantity-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--primary-color);
        }

        .date-display {
            background: var(--primary-gradient);
            color: white;
            padding: 10px;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }

        .alert {
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .btn-group-custom {
                flex-direction: column;
            }

            .voucher-code {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="/admin">
            <i class="fas fa-film"></i> BlueBear Cinema
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/admin/">Dashboard</a>
            <a class="nav-link" href="/admin/movies">Movies</a>
            <a class="nav-link" href="/admin/actors">Actors</a>
            <a class="nav-link active" href="/admin/vouchers">Vouchers</a>
            <a class="nav-link" href="/admin/genres">Genres</a>
        </div>
    </div>
</nav>

<div class="container">
    <!-- Alert Messages -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
        <i class="fas fa-check-circle"></i>
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>Chi Tiết Voucher</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin/">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="/admin/vouchers">Vouchers</a></li>
                    <li class="breadcrumb-item active" th:text="${voucher.promotionCode}">SAVE20</li>
                </ol>
            </nav>
        </div>
        <div class="btn-group-custom d-flex">
            <a href="/admin/vouchers" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Quay Lại
            </a>
            <a th:href="@{/admin/vouchers/edit/{id}(id=${voucher.promotionID})}" class="btn btn-warning">
                <i class="fas fa-edit"></i> Chỉnh Sửa
            </a>
            <!-- Only show delete button if voucher status is Expired -->
            <button th:if="${voucher.status.name() == 'Expired'}"
                    type="button"
                    class="btn btn-danger"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal">
                <i class="fas fa-trash"></i> Xóa
            </button>
        </div>
    </div>

    <div class="row">
        <!-- Main Information -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-ticket-alt"></i> Thông Tin Voucher
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-row">
                                <div class="info-label">Mã Voucher</div>
                                <div class="voucher-code mt-2" th:text="${voucher.promotionCode}">SAVE20</div>
                            </div>

                            <div class="info-row">
                                <div class="info-label">Giá Trị Giảm Giá</div>
                                <div class="mt-2">
                                    <span class="discount-badge" th:text="${voucher.discount + '%'}">20%</span>
                                </div>
                            </div>

                            <div class="info-row">
                                <div class="info-label">Số Lượng Còn Lại</div>
                                <div class="quantity-display" th:text="${voucher.quantity}">100</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-row">
                                <div class="info-label">Ngày Bắt Đầu</div>
                                <div class="date-display mt-2">
                                    <div th:text="${#temporals.format(voucher.startTime, 'dd/MM/yyyy HH:mm')}">15/01/2024 10:00</div>
                                </div>
                            </div>

                            <div class="info-row">
                                <div class="info-label">Ngày Kết Thúc</div>
                                <div class="date-display mt-2">
                                    <div th:text="${#temporals.format(voucher.endTime, 'dd/MM/yyyy HH:mm')}">15/04/2024 23:59</div>
                                </div>
                            </div>

                            <div class="info-row">
                                <div class="info-label">Trạng Thái</div>
                                <div class="mt-2">
                                    <!-- Cách 1: Sử dụng trực tiếp enum status từ voucher -->
                                    <div th:switch="${voucher.status.name()}">
                                        <span th:case="'Available'" class="status-badge status-active">
                                            <i class="fas fa-check-circle"></i> Đang Hoạt Động
                                        </span>
                                        <span th:case="'Expired'" class="status-badge status-expired">
                                            <i class="fas fa-times-circle"></i> Đã Hết Hạn
                                        </span>
                                    </div>

                                    <!-- Cách 2: Nếu muốn kiểm tra thêm thời gian thực tế -->
                                    <!-- Uncomment phần này nếu muốn check theo thời gian thực
                                    <div th:if="${#temporals.createNow().isAfter(voucher.endTime)}" class="status-badge status-expired">
                                        <i class="fas fa-times-circle"></i> Đã Hết Hạn
                                    </div>
                                    <div th:if="${#temporals.createNow().isBefore(voucher.startTime)}" class="status-badge status-pending">
                                        <i class="fas fa-clock"></i> Chưa Bắt Đầu
                                    </div>
                                    <div th:if="${#temporals.createNow().isAfter(voucher.startTime) and #temporals.createNow().isBefore(voucher.endTime)}" class="status-badge status-active">
                                        <i class="fas fa-check-circle"></i> Đang Hoạt Động
                                    </div>
                                    -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Side Information -->
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-info-circle"></i> Thông Tin Thêm
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <div class="info-label">ID Voucher</div>
                        <div class="info-value" th:text="${'#' + voucher.promotionID}">#001</div>
                    </div>

                    <div class="info-row">
                        <div class="info-label">Loại Giảm Giá</div>
                        <div class="info-value">Phần Trăm</div>
                    </div>

                    <div class="info-row">
                        <div class="info-label">Áp Dụng Cho</div>
                        <div class="info-value">Tất Cả Suất Chiếu</div>
                    </div>

                    <div class="info-row">
                        <div class="info-label">Giới Hạn</div>
                        <div class="info-value">Mỗi Khách Hàng 1 Lần</div>
                    </div>

                    <div class="info-row">
                        <div class="info-label">Trạng Thái Hệ Thống</div>
                        <div class="info-value">
                            <span th:switch="${voucher.status.name()}">
                                <span th:case="'Available'">Khả Dụng</span>
                                <span th:case="'Expired'">Hết Hạn</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-lightbulb"></i> Hướng Dẫn
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-check text-success"></i>
                            Nhập mã khi thanh toán để giảm giá
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success"></i>
                            Mỗi mã chỉ sử dụng được 1 lần
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success"></i>
                            Không thể hoàn lại sau khi sử dụng
                        </li>
                        <li>
                            <i class="fas fa-check text-success"></i>
                            Kiểm tra hạn sử dụng trước khi áp dụng
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal - Only shown when voucher is expired -->
<div th:if="${voucher.status.name() == 'Expired'}" class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle text-danger"></i>
                    Xác Nhận Xóa
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa voucher <strong th:text="${voucher.promotionCode}">SAVE20</strong> không?</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    Hành động này không thể hoàn tác!
                </div>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Chỉ có thể xóa voucher đã hết hạn để đảm bảo tính toàn vẹn dữ liệu.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <form th:action="@{/admin/vouchers/delete/{id}(id=${voucher.promotionID})}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Xóa Voucher
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-hide alerts after 5 seconds
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);

    // Copy voucher code to clipboard
    document.addEventListener('DOMContentLoaded', function() {
        const voucherCode = document.querySelector('.voucher-code');
        if (voucherCode) {
            voucherCode.addEventListener('click', function() {
                navigator.clipboard.writeText(this.textContent).then(function() {
                    const originalText = voucherCode.textContent;
                    const originalBg = voucherCode.style.backgroundColor;

                    voucherCode.textContent = 'Đã sao chép!';
                    voucherCode.style.backgroundColor = '#d4edda';
                    voucherCode.style.color = '#155724';

                    setTimeout(function() {
                        voucherCode.textContent = originalText;
                        voucherCode.style.backgroundColor = originalBg;
                        voucherCode.style.color = 'var(--primary-color)';
                    }, 2000);
                });
            });

            voucherCode.style.cursor = 'pointer';
            voucherCode.title = 'Click để sao chép mã voucher';
        }
    });
</script>
</body>
</html>