<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Hồ sơ người dùng - Cinema</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/profile.css}">
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
</div>

<!-- Header -->
<header class="header">
  <div class="container">
    <a href="#" class="logo">
      <i class="fas fa-film"></i>
      Cinema
    </a>
    <nav>
      <ul class="nav-links">
        <li><a href="#"><i class="fas fa-home me-1"></i>Trang chủ</a></li>
        <li><a href="#"><i class="fas fa-film me-1"></i>Phim</a></li>
        <li><a href="#"><i class="fas fa-calendar me-1"></i>Lịch chiếu</a></li>
        <li><a href="#"><i class="fas fa-user me-1"></i>Hồ sơ</a></li>
        <li><a href="#"><i class="fas fa-sign-out-alt me-1"></i>Đăng xuất</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Main Content -->
<main class="main-content">
  <div class="container">
    <!-- Profile Header -->
    <div class="profile-header">
      <h1><i class="fas fa-user-circle me-3"></i>Hồ sơ thành viên</h1>
      <p>Quản lý thông tin cá nhân và lịch sử xem phim</p>
    </div>

    <!-- Profile Cards Grid -->
    <div class="grid-layout">
      <!-- Account Information -->
      <div class="profile-card">
        <div class="card-header-custom">
          <i class="fas fa-id-card"></i>
          Thông tin tài khoản
        </div>
        <div class="card-body-custom">
          <div class="info-row">
            <div class="info-label">
              <i class="fas fa-envelope"></i>
              Email
            </div>
            <div class="info-value" th:text="${account.email}">example@gmail.com</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="fas fa-check-circle"></i>
              Trạng thái
            </div>
            <div class="info-value">
              <span class="status-badge status-active" th:text="${account.status}">Hoạt động</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="profile-card">
        <div class="card-header-custom">
          <i class="fas fa-user"></i>
          Thông tin cá nhân
        </div>
        <div class="card-body-custom">
          <div class="info-row">
            <div class="info-label">
              <i class="fas fa-signature"></i>
              Họ tên
            </div>
            <div class="info-value" th:text="${customer.fullName}">Nguyễn Văn A</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="fas fa-phone"></i>
              Số điện thoại
            </div>
            <div class="info-value" th:text="${customer.phone}">0901234567</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="fas fa-star"></i>
              Điểm tích lũy
            </div>
            <div class="info-value">
              <span class="points-display" th:text="${customer.point} + ' điểm'">150 điểm</span>
            </div>
          </div>
          <div class="mt-4">
            <button class="btn btn-edit" onclick="toggleEditForm()">
              <i class="fas fa-edit me-2"></i>Chỉnh sửa thông tin
            </button>

            <!-- Edit Form -->
            <form th:action="@{/user/profile/update}" method="post" class="mt-4" id="editForm" style="display: none;">
              <input type="hidden" name="customerId" th:value="${customer.id}"/>
              <input type="hidden" name="accountId" th:value="${account.id}"/>

              <div class="mb-3">
                <label for="fullName" class="form-label">Họ tên</label>
                <input type="text" class="form-control" id="fullName" name="fullName"
                       th:value="${customer.fullName}" required>
              </div>

              <div class="mb-3">
                <label for="phone" class="form-label">Số điện thoại</label>
                <input type="text" class="form-control" id="phone" name="phone"
                       th:value="${customer.phone}">
              </div>

              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email"
                       th:value="${account.email}" required>
              </div>

              <div class="mb-3">
                <label for="newPassword" class="form-label">Mật khẩu mới</label>
                <input type="password" class="form-control" id="newPassword" name="newPassword">
              </div>

              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
              </div>

              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">
                  <i class="fas fa-save me-2"></i>Lưu thay đổi
                </button>
                <button type="button" class="btn btn-secondary" onclick="toggleEditForm()">
                  <i class="fas fa-times me-2"></i>Hủy
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Movie History & Rewards -->
    <div class="profile-card">
      <div class="card-header-custom">
        <i class="fas fa-film"></i>
        Lịch sử & Ưu đãi
      </div>
      <div class="card-body-custom p-0">
        <ul class="nav nav-tabs" id="profileTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-history" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
              <i class="fas fa-ticket-alt me-2"></i>Lịch sử đặt vé
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-points" data-bs-toggle="tab" data-bs-target="#points" type="button" role="tab">
              <i class="fas fa-gift me-2"></i>Điểm tích lũy & Ưu đãi
            </button>
          </li>
        </ul>

        <div class="tab-content" id="profileTabContent">
          <!-- Movie History Tab -->
          <div class="tab-pane fade show active" id="history" role="tabpanel">
            <div class="p-4">
              <div th:if="${watchedMovies.isEmpty()}" class="empty-state">
                <i class="fas fa-ticket-alt"></i>
                <h5>Chưa có lịch sử xem phim</h5>
                <p>Bạn chưa xem bộ phim nào tại rạp của chúng tôi.</p>
              </div>

              <div th:if="${!watchedMovies.isEmpty()}" class="movie-history-grid">
                <div class="movie-item" th:each="items, iterStat : ${watchedMovies}">
                  <div class="movie-card-layout">
                    <div class="movie-poster">
                      <img th:src="${items.movie.image}" alt="Poster phim" th:alt="${items.movie.movieName}">
                    </div>

                    <div class="movie-content">
                      <h3 class="movie-title" th:text="${items.movie.movieName}">Dune: Hành Trình Cát - Phần 2</h3>

                      <div class="movie-meta">
                        <div class="movie-detail">
                          <i class="fas fa-clock"></i>
                          <span th:text="${items.movie.duration} + ' phút'">120 phút</span>
                        </div>
                        <div class="movie-detail">
                          <i class="fas fa-building"></i>
                          <span th:text="${items.movie.studio}">Studio</span>
                        </div>
                        <div class="movie-detail">
                          <i class="fas fa-map-marker-alt"></i>
                          <span th:text="${items.theater.theaterName}">Quận 1</span>
                        </div>
                      </div>

                      <div class="theater-badge" th:text="'Rạp ' + ${items.theater.theaterName}">
                        Rạp Quận 1
                      </div>

                      <div class="movie-datetime">
                        25/08/2025 | 19:30 - 22:15
                      </div>

                      <div class="movie-rating">
                        <div class="rating-display">
                          <span class="rating-stars">★★★★★</span>
                          <span class="rating-value" th:text="${#numbers.formatDecimal(items.movie.movieRate, 1, 1)} + '/5'">4.5/5</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="movie-feedback">
                    <form th:action="@{/feedback/submit}" method="post" class="feedback-form">
                      <input type="hidden" name="customerId" th:value="${customer.id}" />
                      <input type="hidden" name="theaterId" th:value="${items.theater.theaterID}" />

                      <textarea name="content" rows="2" class="form-control" placeholder="Góp ý về dịch vụ rạp..."></textarea>

                      <div class="input-group">
                        <label class="input-group-text">
                          <i class="fas fa-star text-warning"></i> Đánh giá
                        </label>
                        <select class="form-select" name="serviceRate">
                          <option value="5">Rất tốt</option>
                          <option value="4">Tốt</option>
                          <option value="3">Bình thường</option>
                          <option value="2">Tệ</option>
                          <option value="1">Rất tệ</option>
                        </select>
                      </div>

                      <button class="btn btn-outline-primary" type="submit">
                        <i class="fas fa-paper-plane me-1"></i>Gửi đánh giá
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

        <!-- Điểm tích lũy & Ưu đãi -->
        <div class="tab-pane fade" id="points" role="tabpanel">
          <div class="p-4">
            <div class="mb-4">
              <p class="mb-3">Bạn hiện có <strong class="points-display" th:text="${customer.point}">150</strong> điểm tích lũy.</p>
              <p class="text-muted">Hãy tiếp tục tích điểm để nhận nhiều phần quà hấp dẫn!</p>
            </div>

            <hr class="my-4">

            <h5 class="mt-4 mb-3"><i class="fas fa-exchange-alt me-2"></i>Quy đổi điểm thưởng</h5>
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead>
                <tr>
                  <th scope="col">Mốc điểm</th>
                  <th scope="col">Phần thưởng</th>
                  <th scope="col">Tình trạng</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td><strong>100 điểm</strong></td>
                  <td>1 vé xem phim miễn phí</td>
                  <td>
                    <span class="badge bg-success" th:if="${customer.point >= 100}">Đủ điều kiện</span>
                    <span class="badge bg-secondary" th:unless="${customer.point >= 100}">Chưa đủ</span>
                  </td>
                </tr>
                <tr>
                  <td><strong>200 điểm</strong></td>
                  <td>1 combo bắp + nước</td>
                  <td>
                    <span class="badge bg-success" th:if="${customer.point >= 200}">Đủ điều kiện</span>
                    <span class="badge bg-secondary" th:unless="${customer.point >= 200}">Chưa đủ</span>
                  </td>
                </tr>
                <tr>
                  <td><strong>300 điểm</strong></td>
                  <td>Voucher giảm 50% cho 1 vé tiếp theo</td>
                  <td>
                    <span class="badge bg-success" th:if="${customer.point >= 300}">Đủ điều kiện</span>
                    <span class="badge bg-secondary" th:unless="${customer.point >= 300}">Chưa đủ</span>
                  </td>
                </tr>
                <tr>
                  <td><strong>500 điểm</strong></td>
                  <td>2 vé VIP + Combo đặc biệt</td>
                  <td>
                    <span class="badge bg-success" th:if="${customer.point >= 500}">Đủ điều kiện</span>
                    <span class="badge bg-secondary" th:unless="${customer.point >= 500}">Chưa đủ</span>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>

            <div class="mt-4 p-3 bg-light rounded">
              <p class="mb-0 text-muted">
                <i class="fas fa-info-circle me-2"></i>
                Điểm thưởng có thể được quy đổi tại quầy vé hoặc trong mục "Ưu đãi" của ứng dụng.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  </main>
<footer class="bg-dark text-light pt-5 pb-4 mt-5">
  <div class="container text-center text-md-left">
    <div class="row text-center text-md-left">
      <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
        <h5 class="text-uppercase mb-4 font-weight-bold text-warning">Cinema</h5>
        <p>Trải nghiệm điện ảnh tuyệt vời cùng chúng tôi!</p>
      </div>
      <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mt-3">
        <h6 class="text-uppercase mb-4 font-weight-bold">Links</h6>
        <p><a href="#" class="text-light" style="text-decoration: none;">Trang chủ</a></p>
        <p><a href="#" class="text-light" style="text-decoration: none;">Phim</a></p>
        <p><a href="#" class="text-light" style="text-decoration: none;">Lịch chiếu</a></p>
        <p><a href="#" class="text-light" style="text-decoration: none;">Liên hệ</a></p>
      </div>
      <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mt-3">
        <h6 class="text-uppercase mb-4 font-weight-bold">Hỗ trợ</h6>
        <p><a href="#" class="text-light" style="text-decoration: none;">FAQ</a></p>
        <p><a href="#" class="text-light" style="text-decoration: none;">Điều khoản</a></p>
        <p><a href="#" class="text-light" style="text-decoration: none;">Chính sách bảo mật</a></p>
      </div>
      <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mt-3">
        <h6 class="text-uppercase mb-4 font-weight-bold">Liên hệ</h6>
          <p><i class="fas fa-home mr-3"></i> HÒA LẠC, TP HÀ NỘI</p>
          <p><i class="fas fa-envelope mr-3"></i> support@cinema.com</p>
          <p><i class="fas fa-phone mr-3"></i> +84 123 456 789</p>
      </div>
    </div>
    <hr class="mb-4">
    <div class="row align-items-center">
      <div class="col-md-7 col-lg-8">
        <p>© 2025 Cinema. All Rights Reserved.</p>
      </div>
      <div class="col-md-5 col-lg-4">
        <div class="text-center text-md-right">
          <ul class="list-unstyled list-inline">
            <li class="list-inline-item">
              <a href="#" class="btn-floating btn-sm text-light" style="font-size:23px;"><i class="fab fa-facebook"></i></a>
            </li>
            <li class="list-inline-item">
              <a href="#" class="btn-floating btn-sm text-light" style="font-size:23px;"><i class="fab fa-twitter"></i></a>
            </li>
            <li class="list-inline-item">
              <a href="#" class="btn-floating btn-sm text-light" style="font-size:23px;"><i class="fab fa-instagram"></i></a>
            </li>
            <li class="list-inline-item">
              <a href="#" class="btn-floating btn-sm text-light" style="font-size:23px;"><i class="fab fa-linkedin"></i></a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Initialize Bootstrap tabs
  const triggerTabList = document.querySelectorAll('#profileTabs button');
  triggerTabList.forEach(triggerEl => {
    const tabTrigger = new bootstrap.Tab(triggerEl);

    triggerEl.addEventListener('click', event => {
      event.preventDefault();
      tabTrigger.show();
    });
  });

  // Add smooth scrolling and fade-in animations
  document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.profile-card');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, { threshold: 0.1 });

    cards.forEach(card => {
      observer.observe(card);
    });
  });
  function toggleEditForm() {
    const form = document.getElementById("editForm");
    form.style.display = form.style.display === "none" ? "block" : "none";
  }
  document.querySelector('form').addEventListener('submit', function(e) {
    const pass = document.getElementById('newPassword').value;
    const confirm = document.getElementById('confirmPassword').value;
    if (pass && pass !== confirm) {
      alert("Mật khẩu xác nhận không khớp!");
      e.preventDefault();
    }
  });
</script>

</body>
</html>