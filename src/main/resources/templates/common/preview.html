<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <title>Xem vé xem phim</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/booking.css}">
</head>
<body>
<div class="container my-5">
    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-primary text-white rounded-top-4">
            <h2 class="mb-0"><i class="bi bi-ticket-perforated"></i> Xác nhận đặt vé</h2>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <strong>Lịch chiếu:</strong>
                <span class="text-muted">[[${schedule.movie.movieName}]] - [[${#temporals.format(schedule.startTime, 'dd/MM/yyyy HH:mm')}]]</span>
            </div>

            <div class="mb-3">
                <strong>Phòng:</strong>
                <span class="text-muted">[[${room.name}]]</span>
            </div>

            <div class="mb-3">
                <strong>Ghế đã chọn:</strong>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center"
                        th:each="seat : ${selectedSeats}">
                        <span><i class="bi bi-chair"></i> [[${seat.position}]]</span>
                        <span class="badge bg-success">[[${#numbers.formatDecimal(seat.unitPrice, 0, 0)}]]đ</span>
                    </li>
                </ul>
            </div>

            <div class="mb-3">
                <strong>Combo:</strong>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center"
                        th:each="combo : ${comboList}">
                        <div>
                            <i class="bi bi-cup-straw"></i> [[${combo.foodName}]] - Số lượng: [[${comboQuantities[combo.theaterStockID]}]]
                        </div>
                        <span class="badge bg-warning text-dark">
                            [[${#numbers.formatDecimal(combo.unitPrice, 0, 0)}]]đ
                        </span>
                    </li>
                </ul>
            </div>

            <div class="mb-3">
                <strong>Tổng tiền:</strong>
                <span class="fs-5 text-primary fw-bold">[[${#numbers.formatDecimal(totalPrice, 0, 0)}]]đ</span>
            </div>

            <div class="mb-3" th:if="${promotion != null}">
                <strong>Khuyến mãi:</strong>
                <span class="text-success">
                    [[${promotion.promotionCode}]] ([[${promotion.discount}]]%)
                </span>
            </div>

            <div class="mb-3" th:if="${promotion == null}">
                <strong>Khuyến mãi:</strong>
                <span class="text-muted">Không có</span>
            </div>

            <div class="mb-3">
                <strong>Thành tiền sau khuyến mãi:</strong>
                <span class="fs-4 text-danger fw-bold">
                    [[${#numbers.formatDecimal(finalPrice, 0, 0)}]]đ
                </span>
            </div>
            <div class="text-start mt-4">
                <form th:action="@{/booking/step1}" method="post">
                    <!-- Hidden fields -->
                    <input type="hidden" name="scheduleId" th:value="${schedule.scheduleId}">
                    <input type="hidden" name="roomId" th:value="${room.roomId}">
                    <input type="hidden" th:each="seat : ${selectedSeats}" name="selectedSeats" th:value="${seat.seatId}">
                    <input type="hidden" name="promotionCode" th:value="${promotionCode}">

                    <button type="submit" class="btn btn-secondary btn-lg">
                        <i class="bi bi-arrow-left"></i> Quay lại trang đặt đồ ăn
                    </button>
                </form>
            </div>
            <form method="post" th:action="@{/booking/confirm}">
                <!-- Hidden fields -->
                <input type="hidden" name="scheduleId" th:value="${schedule.scheduleId}">
                <input type="hidden" name="roomId" th:value="${room.roomId}">

                <!-- Chỉ hiển thị promotionCode nếu promotion != null -->
                <div th:if="${promotion != null}">
                    <input type="hidden" name="promotionCode" th:value="${promotion.promotionCode}">
                </div>
                <div th:if="${promotion == null}">
                    <input type="hidden" name="promotionCode" value="">
                </div>

                <input type="hidden" th:each="seat : ${selectedSeats}" name="selectedSeats" th:value="${seat.seatId}" />
                <input type="hidden" th:each="combo : ${comboList}"
                       th:if="${comboQuantities[combo.theaterStockID] != null}"
                       th:name="'comboQuantities[' + ${combo.theaterStockID} + ']'"
                       th:value="${comboQuantities[combo.theaterStockID]}" />

                <div class="text-end mt-4">


                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="bi bi-check-circle"></i> Xác nhận và thanh toán
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>
</body>
</html>
