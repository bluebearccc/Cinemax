<!DOCTYPE html>
<html   xmlns:th="http://www.thymeleaf.org"
        lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" th:href="@{/staff/img/apple-icon.png}">
  <link rel="icon" type="image/png" th:href="@{/staff/img/apple-icon.png}">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css" th:href="@{/staff/css/roboto-text-font-style.css}" />
  <link rel="stylesheet" type="text/css" th:href="@{/staff/css/fontawesome.css}" />
  <!-- CSS Files -->
  <link th:href="@{/staff/css/material-dashboard.minf066.css}" rel="stylesheet" />
  <!-- Add this in the head section -->
  <style>
    .error-message {
      color: #ff0000;
      font-size: 12px;
      margin-top: 5px;
    }
  </style>
<body class="dark-edition">

<div class="wrapper ">
  <div class="sidebar" data-color="purple" data-background-color="black" data-image="../e/img/sidebar-2.jpg">
    <div class="logo"><a href="http://www.creative-tim.com/" class="simple-text logo-normal">
    <span th:text="${employee.getFullName()}"></span>
    </a></div>
    <div class="sidebar-wrapper">
      <ul class="nav">
        <li class="nav-item active ">
          <a class="nav-link" th:href="@{/theater_stock}">
            <i class="material-icons">content_paste</i>
            <p>Manage Food and Drinks</p>
          </a>
        </li>
      </ul>
    </div>
  </div>
  <div class="main-panel">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top " id="navigation-example">
      <div class="container-fluid">
        <div class="navbar-wrapper">
          <a class="navbar-brand" th:href="@{/theater_stock}"><u>View List item</u></a>
        </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation" data-target="#navigation-example">
          <span class="sr-only">Toggle navigation</span>
          <span class="navbar-toggler-icon icon-bar"></span>
          <span class="navbar-toggler-icon icon-bar"></span>
          <span class="navbar-toggler-icon icon-bar"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end"><ul class="navbar-nav">
               <li class="nav-item">
                 <a class="nav-link" href="javascript:void(0)">
                   <i class="material-icons">dashboard</i>
                   <p class="d-lg-none d-md-block">
                     Stats
                   </p>
                 </a>
               </li>
               <li class="nav-item">
                 <a class="nav-link" href="javascript:void(0)">
                   <i class="material-icons">person</i>
                   <p class="d-lg-none d-md-block">
                     Account
                   </p>
                 </a>
               </li>
             </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->
    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header card-header-primary">
                <h4 class="card-title">Edit Profile</h4>
                <p class="card-category">Complete your profile</p>
              </div>
              <div class="card-body">
                <!-- Update the form section -->
                <form th:action="@{/theater_stock/process_stock}"
                      th:object="${theaterStock}"
                      method="post"
                      enctype="multipart/form-data"
                      id="stockForm"
                      onsubmit="return validateForm()">

                  <input type="hidden" th:field="*{stockId}"></input>
                  <input type="hidden" name="theaterID"  th:value="${employee.theater.theaterId}"></input>
                  <div class="row">
                    <!-- Left Column - General Information -->
                    <div class="col-md-6">
                      <!-- Theater -->
                      <div class="form-group">
                        <label class="bmd-label-floating">Theater</label>
                        <input type="text" class="form-control" th:value="${employee.theater.getTheaterName()}" disabled>
                      </div>

                      <!-- Name -->
                      <div class="form-group">
                        <label class="bmd-label-floating">Name</label>
                        <input type="text"
                               class="form-control"
                               th:field="*{itemName}"
                               maxlength="20"
                               required>
                        <div class="error-message" id="nameError"></div>
                      </div>

                      <!-- Quantity -->
                      <div class="form-group">
                        <label class="bmd-label-floating">Quantity</label>
                        <input type="number"
                               class="form-control"
                               th:field="*{quantity}"
                               min="0"
                               required>
                        <div class="error-message" id="quantityError"></div>
                      </div>

                      <!-- Price -->
                      <div class="form-group">
                        <label class="bmd-label-floating">Price</label>
                        <input type="number"
                               step="0.01"
                               class="form-control"
                               th:field="*{price}"
                               min="0"
                               max="99999999.99"
                               required>
                        <div class="error-message" id="priceError"></div>
                      </div>
                      <div class="form-group">
                        <label class="bmd-label-floating">Set Status</label>
                        <div class="d-flex align-items-center mt-2">
                          <label class="radio-inline mr-3 mb-0">
                            <input type="radio" name="status" value="Active" th:field="*{status}" th:checked="${theaterStock.status == 'Active'}" class="mr-1"/> Active
                          </label>
                          <label class="radio-inline mb-0">
                            <input type="radio" name="status" value="Inactive" th:field="*{status}" th:checked="${theaterStock.status == 'Inactive'}" class="mr-1"/> Inactive
                          </label>
                        </div>
                        <div class="error-message" id="statusError"></div>
                      </div>
                    </div>

                    <!-- Right Column - Image Upload -->
                    <div class="col-md-6">
                      <div class="form-group">
                        <label>Current Image:</label>
                        <img th:if="${theaterStock.image}" th:src="${theaterStock.image}" style="width: 200px; height: auto; display: block; margin-bottom: 10px;">
                        <input type="hidden" th:field="*{image}">
                      </div>
                      <!-- Image input -->
                      <div class="form-group">
                        <label style="border: 2px solid #ffffff; padding: 5px;" for="imageInput" class="form-label">Upload new image</label>
                        <input
                                type="file"
                                class="form-control"
                                id="imageInput"
                                name="imageInput"
                                accept="image/*"
                                aria-label="Upload image"
                                aria-describedby="imageHelp"
                        > <!-- Remove required attribute -->
                        <div id="imageHelp" class="form-text">
                        </div>
                        <div id="imagePreview" class="mt-2"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Buttons -->
                  <div class="row mt-4">
                    <div class="col-12">
                      <button type="submit" class="btn btn-primary" style="width: 100px; margin-right: 10px">Save</button>
                      <button type="reset" class="btn btn-primary" style="width: 100px; margin-right: 10px">Reset</button>
                      <a th:href="@{/theater_stock}" class="btn btn-danger" style="width: 100px">Cancel</a>
                    </div>
                  </div>
                  <div class="clearfix"></div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--   Core JS Files   -->
<script th:src="@{/staff/js/core/jquery.min.js}"></script>
<script th:src="@{/staff/js/core/popper.min.js}"></script>
<script th:src="@{/staff/js/core/bootstrap-material-design.min.js}"></script>
<script th:src="@{/staff/js/core/default-passive-events}"></script>
<script th:src="@{/staff/js/plugins/perfect-scrollbar.jquery.min.js}"></script>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" rel="stylesheet">
<script>
  document.getElementById('imageInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const imagePreview = document.getElementById('imagePreview');

    if (file) {
      if (!file.type.startsWith('image/')) {
        alert('Please upload an image file');
        return;
      }

      const reader = new FileReader();

      reader.onload = function(e) {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.width = '508px';
        img.style.height = '301px';
        img.style.marginTop = '10px';
        imagePreview.innerHTML = '';
        imagePreview.appendChild(img);
      };

      reader.readAsDataURL(file);
    }
  });

  // Validation function
  function validateForm() {
    let isValid = true;
    
    // Clear previous error messages
    document.getElementById('nameError').textContent = '';
    document.getElementById('quantityError').textContent = '';
    document.getElementById('priceError').textContent = '';
    
    // Get form values
    const name = document.querySelector('input[name="itemName"]').value.trim();
    const quantity = document.querySelector('input[name="quantity"]').value;
    const price = document.querySelector('input[name="price"]').value;
    const status = document.querySelector('input[name="status"]:checked');
    const imageInput = document.getElementById('imageInput');
    const currentImage = document.querySelector('input[name="image"]').value; // Hidden field có ảnh hiện tại
    
    // Validate Name - chỉ chứa số, chữ cái, dấu cách
    const nameRegex = /^[a-zA-Z0-9\s]+$/;
    if (!name) {
      document.getElementById('nameError').textContent = 'Name is required';
      isValid = false;
    } else if (!nameRegex.test(name)) {
      document.getElementById('nameError').textContent = 'Name can only contain letters, numbers, and spaces';
      isValid = false;
    } else if (name.length > 20) {
      document.getElementById('nameError').textContent = 'Name cannot exceed 20 characters';
      isValid = false;
    }
    
    // Validate Quantity
    if (!quantity) {
      document.getElementById('quantityError').textContent = 'Quantity is required';
      isValid = false;
    } else if (quantity < 0) {
      document.getElementById('quantityError').textContent = 'Quantity must be a positive number';
      isValid = false;
    } else if (!Number.isInteger(Number(quantity))) {
      document.getElementById('quantityError').textContent = 'Quantity must be a whole number';
      isValid = false;
    }
    
    // Validate Price
    if (!price) {
      document.getElementById('priceError').textContent = 'Price is required';
      isValid = false;
    } else if (price < 0) {
      document.getElementById('priceError').textContent = 'Price must be a positive number';
      isValid = false;
    } else if (price > 99999999.99) {
      document.getElementById('priceError').textContent = 'Price cannot exceed 99,999,999.99';
      isValid = false;
    }
    
    // Validate Status
    if (!status) {
      alert('Please select a status (Active or Inactive)');
      isValid = false;
    }
    
    if (!imageInput.files || imageInput.files.length === 0) {
      // Không có file mới được chọn, kiểm tra có ảnh hiện tại không
      if (!currentImage || currentImage.trim() === '') {
        alert('Please upload an image');
        isValid = false;
      }
    } else {
      const file = imageInput.files[0];
      if (!file.type.startsWith('image/')) {
        alert('Please upload a valid image file');
        isValid = false;
      }
    }
    
    return isValid;
  }

  // Real-time validation for name field
  document.querySelector('input[name="itemName"]').addEventListener('input', function(e) {
    const nameRegex = /^[a-zA-Z0-9\s]+$/;
    const nameError = document.getElementById('nameError');
    const value = e.target.value.trim();
    
    if (value && !nameRegex.test(value)) {
      nameError.textContent = 'Name can only contain letters, numbers, and spaces';
    } else {
      nameError.textContent = '';
    }
  });

  // Real-time validation for quantity field
  document.querySelector('input[name="quantity"]').addEventListener('input', function(e) {
    const quantityError = document.getElementById('quantityError');
    const value = e.target.value;
    
    if (value && (!Number.isInteger(Number(value)) || Number(value) < 0)) {
      quantityError.textContent = 'Quantity must be a positive whole number';
    } else {
      quantityError.textContent = '';
    }
  });

  // Real-time validation for price field
  document.querySelector('input[name="price"]').addEventListener('input', function(e) {
    const priceError = document.getElementById('priceError');
    const value = e.target.value;
    
    if (value && (Number(value) < 0 || Number(value) > 99999999.99)) {
      priceError.textContent = 'Price must be between 0 and 99,999,999.99';
    } else {
      priceError.textContent = '';
    }
  });
</script>
</body>
</html>