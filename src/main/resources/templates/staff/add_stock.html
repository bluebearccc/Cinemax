    <!DOCTYPE html>

    <html xmlns:th="http://www.thymeleaf.org" lang="vi">



    <head>

        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Food And Drink</title>

        <link rel="stylesheet" th:href="@{/staff/css/style.css}">

        <link rel="stylesheet" th:href="@{/staff/css/add_update_item.css}">
<style>
    .alert {
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid transparent;
        border-radius: 4px;
        font-size: 16px;
        text-align: center;
    }

    /* Style ri√™ng cho th√¥ng b√°o l·ªói (m√†u ƒë·ªè) */
    .alert-error {
        color: #a94442; /* M√†u ch·ªØ ƒë·ªè s·∫´m */
        background-color: #f2dede; /* M√†u n·ªÅn h·ªìng nh·∫°t */
        border-color: #ebccd1; /* M√†u vi·ªÅn h·ªìng s·∫´m */
    }

    /* B·∫°n c≈©ng c√≥ th·ªÉ th√™m style cho th√¥ng b√°o th√†nh c√¥ng (m√†u xanh) n·∫øu c·∫ßn */
    .alert-success {
        color: #3c763d;
        background-color: #dff0d8;
        border-color: #d6e9c6;
    }
</style>
    </head>

    <body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="user-info">
            <div class="user-avatar" th:text="${#strings.substring(name,0,1)}"></div>
            <div class="user-name" th:text="${name}"></div>
        </div>
        <a th:href="@{/staff/home}" class="sidebar-item">
            <div class="sidebar-icon">üè†</div>
            <div class="sidebar-text">Home</div>
        </a>
        <a th:href="@{/staff/theater_stock}" class="sidebar-item active">
            <div class="sidebar-icon">üçø</div>
            <div class="sidebar-text">Food and Drinks</div>
        </a>
        <a th:href="@{/staff/movie_schedule}" class="sidebar-item">
            <div class="sidebar-icon">üìÖ</div>
            <div class="sidebar-text">Set Schedule</div>
        </a>
        <a th:href="@{/staff/theater}" class="sidebar-item">
            <div class="sidebar-icon">üé¨</div>
            <div class="sidebar-text">Manage Theater</div>
        </a>
    </div>
    <div class="main-content">
        <div class="header">
            <div class="header-left">
                <div class="breadcrumb">
                    <a th:href="@{/staff/theater_stock}">Food and Drinks</a> >
                    <span> Add new Item</span>
                </div>
            </div>
        </div>
        <div th:if="${error}" class="alert alert-error">
            <span th:text="${error}"></span>
        </div>
        <div class="form-container">
            <div class="form-header">
                <p class="form-subtitle">Complete the item information</p>
            </div>
            <form th:action="@{/staff/theater_stock/add_stock}"
                  th:object="${theaterStock}"
                  method="post"
                  enctype="multipart/form-data"
                  id="stockForm"
                  onsubmit="return validateForm()">
                <input type="hidden" th:field="*{theaterStockId}">
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Name</label>
                            <input type="text"
                                   class="form-input"
                                   th:field="*{foodName}"
                                   maxlength="20"
                                   placeholder="Enter item name"
                                   required>
                            <div class="error-message" id="nameError"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quantity</label>
                            <input type="number"
                                   class="form-input"
                                   th:field="*{quantity}"
                                   min="1"
                                   step="1"
                                   placeholder="Enter quantity"
                                   required>
                            <div class="error-message" id="quantityError"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price</label>
                            <input type="number"
                                   step="0.01"
                                   class="form-input"
                                   th:field="*{unitPrice}"
                                   min="1000"
                                   max="99999999.99"
                                   placeholder="Enter price(VND)"
                                   required>
                            <div class="error-message" id="priceError"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Set Status</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio"
                                           id="statusActive"
                                           name="status"
                                           value="Active"
                                           th:field="*{status}"
                                           th:checked="${theaterStock.status == 'Active'}"
                                           checked
                                    >
                                    <label for="statusActive">Active</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio"
                                           id="statusInactive"
                                           name="status"
                                           value="Inactive"
                                           th:field="*{status}"
                                           th:checked="${theaterStock.status == 'Inactive'}">
                                    <label for="statusInactive">Inactive</label>
                                </div>
                            </div>
                            <div class="error-message" id="statusError"></div>
                        </div>
                    </div>
                    <div class="form-column">
                        <!-- Image Upload -->
                        <div class="form-group">
                            <label class="form-label">Upload New Image</label>
                            <div class="image-upload-area" onclick="document.getElementById('imageInput').click()">
                                <div>üì∏</div>
                                <p>Click to upload or drag and drop</p>
                            </div>
                            <input type="file"
                                   id="imageInput"
                                   name="imageInput"
                                   accept="image/*"
                                   style="display: none;"
                                   onchange="previewImage(this)">
                            <div id="imagePreview" class="image-preview"></div>
                            <div class="error-message" id="imageError"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Add to Theaters</label>
                    <div class="checkbox-group">
                        <div th:each="theater : ${allTheaters}" class="checkbox-item">
                            <input type="checkbox" th:id="'theater-' + ${theater.theaterID}" name="theaterIds" th:value="${theater.theaterID}">
                            <label th:for="'theater-' + ${theater.theaterID}" th:text="${theater.theaterName}"></label>
                        </div>
                    </div>
                    <div class="error-message" id="theaterError"></div>
                </div>
                <!-- Buttons -->
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="reset" class="btn btn-secondary" onclick="resetForm()">Reset</button>
                    <a th:href="@{/staff/theater_stock}" class="btn btn-danger">Cancel</a>
                </div>
            </form>
        </div>
    </div>
    <script>
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            if (input.files) {
                const file = input.files[0];
                if (!file.type.startsWith('image/')) {
                    alert('Please upload an image file');
                    input.value = '';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        // H√†m reset form
        function resetForm() {
            document.getElementById('stockForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
            const activeRadio = document.getElementById('statusActive');
            if(activeRadio) {
                activeRadio.checked = true;
            }
        }

        function validateForm() {
            let isValid = true;
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

            const nameInput = document.querySelector('input[name="foodName"]');
            const quantityInput = document.querySelector('input[name="quantity"]');
            const priceInput = document.querySelector('input[name="unitPrice"]');
            const imageInput = document.getElementById('imageInput');
            const currentImage = document.querySelector('input[name="image"]');

            const name = nameInput ? nameInput.value.trim() : '';
            const quantity = quantityInput ? quantityInput.value : '';
            const price = priceInput ? priceInput.value : '';

            const status = document.querySelector('input[name="status"]:checked');
            const selectedTheaters = document.querySelectorAll('input[name="theaterIds"]:checked').length;

            const nameRegex = /^[a-zA-Z0-9\s]+$/;
            if (!name) {
                document.getElementById('nameError').textContent = 'Name is required';
                isValid = false;
            } else if (!nameRegex.test(name)) {
                document.getElementById('nameError').textContent = 'Name must not contain special characters';
                isValid = false;
            }

            // Validate Quantity
            if (!quantity) {
                document.getElementById('quantityError').textContent = 'Quantity is required';
                isValid = false;
            } else if (!/^\d+$/.test(quantity) || parseInt(quantity) <= 0) {
                document.getElementById('quantityError').textContent = 'Quantity must be a positive whole number';
                isValid = false;
            }

            // Validate Price
            if (!price) {
                document.getElementById('priceError').textContent = 'Price is required';
                isValid = false;
            } else if (price < 0) {
                document.getElementById('priceError').textContent = 'Price must be a positive number';
                isValid = false;
            } else if (price > 99999999.99) {
                document.getElementById('priceError').textContent = 'Price cannot exceed 99,999,999.99';
                isValid = false;
            }

            // Validate Status (gi·ªØ nguy√™n)
            if (!status) {
                document.getElementById('statusError').textContent = 'Please select a status';
                isValid = false;
            }

            // S·ª¨A L·∫†I VALIDATE CHO THEATER
            if (selectedTheaters === 0) {
                document.getElementById('theaterError').textContent = 'Please select at least one theater.'; // D√≤ng m·ªõi
                isValid = false;
            }

            // S·ª¨A L·∫†I VALIDATE CHO IMAGE
            if (!imageInput.files || imageInput.files.length === 0) {
                // Ch·ªâ b·∫Øt bu·ªôc upload ·∫£nh khi th√™m m·ªõi. Khi edit, ·∫£nh c≈© l√† h·ª£p l·ªá.
                if (!currentImage || !currentImage.value) { // ƒê∆°n gi·∫£n h√≥a ƒëi·ªÅu ki·ªán
                    // alert('Please upload an image'); // D√≤ng c≈©
                    document.getElementById('imageError').textContent = 'Please upload an image.'; // D√≤ng m·ªõi
                    isValid = false;
                }
            } else {
                const file = imageInput.files[0];
                if (!file.type.startsWith('image/')) {
                    document.getElementById('imageError').textContent = 'Please upload a valid image file (PNG, JPG, etc.).'; // D√≤ng m·ªõi
                    isValid = false;
                }
            }

            return isValid;
        }

        document.addEventListener('DOMContentLoaded', function() {

            const nameInput = document.querySelector('input[th\\:field="*{foodName}"]');
            if(nameInput) {
                nameInput.addEventListener('input', function(e) {
                    const nameRegex = /^[a-zA-Z0-9\s]+$/;
                    const nameError = document.getElementById('nameError');
                    const value = e.target.value;
                    if (value && !nameRegex.test(value)) {
                        nameError.textContent = 'Name can only contain letters, numbers, and spaces';
                    } else {
                        nameError.textContent = '';
                    }
                });
            }

            const quantityInput = document.querySelector('input[th\\:field="*{quantity}"]');
            if(quantityInput) {
                quantityInput.addEventListener('input', function(e) {
                    const quantityError = document.getElementById('quantityError');
                    const value = e.target.value;
                    if (value && (!/^\d+$/.test(value) || parseInt(value) < 0)) {
                        quantityError.textContent = 'Quantity must be a non-negative whole number';
                    } else {
                        quantityError.textContent = '';
                    }
                });
            }

            const priceInput = document.querySelector('input[th\\:field="*{unitPrice}"]');
            if(priceInput) {
                priceInput.addEventListener('input', function(e) {
                    const priceError = document.getElementById('priceError');
                    if (e.target.value && e.target.value < 0) {
                        priceError.textContent = 'Price must be a positive number';
                    } else {
                        priceError.textContent = '';
                    }
                });
            }

        });
    </script>
    </body>
    </html>