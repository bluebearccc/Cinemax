<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Schedule</title>
    <link rel="stylesheet" th:href="@{/staff/css/style.css}">
    <link rel="stylesheet" th:href="@{/staff/css/movie_schedule.css}">
</head>
<body>
<div class="sidebar">
    <div class="user-info">
        <div class="user-avatar">M</div>
        <div class="user-name" >Mary Johnson</div>
    </div>

    <a href="#" class="sidebar-item">
        <div class="sidebar-icon">üè†</div>
        <div class="sidebar-text">Home</div>
    </a>
    <a th:href="@{/theater_stock}" class="sidebar-item ">
        <div class="sidebar-icon">üçø</div>
        <div class="sidebar-text">Food and Drinks</div>
    </a>
    <a th:href="@{/movie_schedule}" class="sidebar-item active ">
        <div class="sidebar-icon">üé¨</div>
        <div class="sidebar-text">Set Schedule</div>
    </a>
</div>
    <div class="main-content">
        <!-- Th√¥ng tin chi ti·∫øt phim -->
        <div class="header">
            <div class="movie-info">
                <div class="movie-poster">
                    <img th:src="${movie.image}" alt="Movie Poster">
                </div>
                <div class="movie-details">
                    <h1><span th:text="${movie.movieName}"></span></h1>
                    <div class="movie-meta">
                        <div class="duration-badge">
                        Durations:<span th:text="${movie.duration}"></span> minutes
                        </div>
                    </div>
                    <div class="date-range-container">
                        <div class="date-range-label">
                            Screening Period
                        </div>
                        <div class="date-range-value">
                            <span th:text="${movie.formattedStartDate()}"></span> <span class="date-arrow">‚Üí</span> <span th:text="${movie.formattedEndDate()}"></span>
                        </div>
                    </div>
                </div>
                <div>
                    <button class="add-schedule-btn" onclick="addNewSchedule()">
                        + Add new Schedule
                    </button>
                </div>
            </div>
        </div>

        <div class="schedule-section">
            <div class="schedule-header">
                <h2>Schedule</h2>
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="previousMonth()">‚Äπ</button>
                    <span class="current-month" id="currentMonth">Th√°ng 6, 2025</span>
                    <button class="nav-btn" onclick="nextMonth()">‚Ä∫</button>
                </div>
            </div>

            <!-- Calendar -->
            <div class="calendar" id="calendar">
                <!-- Calendar headers -->
                <div class="calendar-header">Mo</div>
                <div class="calendar-header">Tu</div>
                <div class="calendar-header">We</div>
                <div class="calendar-header">Th</div>
                <div class="calendar-header">Fr</div>
                <div class="calendar-header">Sa</div>
                <div class="calendar-header">Su</div>

            </div>

            <div class="daily-schedule" id="dailySchedule">
                <div class="schedule-date"></div>
                <div class="schedule-list">
                    <div class="schedule-item">
                        <div class="schedule-time"></div>
                        <div class="schedule-details">
                            <span class="room-info"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">New Schedule</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>

            <form th:action="@{/movie_schedule/add_schedule}"  id="scheduleForm" method="POST" class="modal-body">

                <input type="hidden" name="movieId" th:value="${movie.getMovieId()}">

                <div class="form-group">
                    <label class="form-label">Select Date</label>
                    <div class="calendar-nav-mini">
                        <button type="button" class="nav-btn-mini" onclick="previousMonthMini()">‚Äπ</button>
                        <span class="current-month-mini" id="currentMonthMini"></span>
                        <button type="button" class="nav-btn-mini" onclick="nextMonthMini()">‚Ä∫</button>
                    </div>
                    <div class="mini-calendar" id="miniCalendar">
                        <!-- Mini calendar will be generated here -->
                    </div>
                    <input type="hidden" id="selectedDateInput" name="date">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="startTime">StartTime</label>
                        <input type="text"
                               id="startTime"
                               name="startTime"
                               class="form-input"
                               placeholder="HH:mm"
                               pattern="([01][0-9]|2[0-3]):[0-5][0-9]"
                               required>
                    </div>
                   <!--
                    ch·ªâ ƒë∆∞·ª£c nh·∫≠p v√†o t·ª´ 8h ƒë·∫øn  tr∆∞·ªõc 24h
                    t·ª± t√≠nh ra b·∫±ng startTime + duration v√† hi·ªÉn th·ªã l√™n m√†n h√¨nh
                    <div class="form-group">
                        <label class="form-label" for="endTime">EndTime</label>
                        <input type="text"
                               id="endTime"
                               name="endTime"
                               class="form-input"
                               placeholder="HH:mm"
                               title="Vui l√≤ng nh·∫≠p th·ªùi gian theo ƒë·ªãnh d·∫°ng HH:mm (v√≠ d·ª•: 09:30 ho·∫∑c 23:59)."
                               readonly>
                    </div> -->
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="room">Room</label>
                        <select class="form-select" id="room" name="room" required>
                            <option value="">Select Room</option>
                            <option  th:each="x : ${rooms}" th:text="${x.name}"
                                     th:value="${x.getRoomId()}"
                                     th:selected="${x.getRoomId() == receivedRoomId}">
                            </option>
                        </select>
                    </div>
                </div>

                <div id="schedule-list-container" class="form-row">

                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-save">Save</button>
                </div>
            </form>
        </div>
    </div>


    <script th:inline="javascript">
        const serverData = {
            schedules: [(${schedules})],
            startTime: [[${startTime}]],
            endTime: [[${endTime}]]
        }
    </script>

    <script th:src="@{/staff/js/schedule.js}"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script th:inline="javascript">
        $(function(){
            $('#room').on('change', function(){
                var roomId = $(this).val();
                var movieId = $('input[name="movieId"]').val();
                var selectedDate = $('#selectedDateInput').val();
                if (roomId) {
                    // G·ª≠i y√™u c·∫ßu AJAX
                    $.ajax({
                        type: 'GET',
                        url: '/movie_schedule/schedule_fragment',
                        data: {
                            roomId: roomId,
                            movieId: movieId,
                            date: selectedDate
                        },
                        success: function(fragment) {
                            $('#schedule-list-container').html(fragment);
                        },
                        error: function() {
                            alert('Error loading schedules.');
                            $('#schedule-list-container').html('');
                        }
                    });
                } else {
                    $('#schedule-list-container').html('');
                }
            })
        });
    </script>
</body>
</html>